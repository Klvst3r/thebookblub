5. Estructura de un aaplicaci贸n con Yii2

驴Qu茅 es la estructura de archivos en Yii?

Al desarrollar una aplicaci贸n web con Yii, una de las primeras tareas es familiarizarse con la estructura de archivos del proyecto. Esta estructura define c贸mo se organizan los diversos componentes y es crucial para garantizar una gesti贸n eficiente y efectiva del desarrollo. Yii utiliza el patr贸n de dise帽o Model-View-Controller (MVC), que facilita mantener un c贸digo limpio y organizado. A continuaci贸n, desglosamos los componentes esenciales de este sistema.
驴C贸mo se configura el entorno de desarrollo?

Para comenzar con Yii, es necesario instalar el framework en tu sistema, lo cual te proporciona una estructura b谩sica de archivos. Dentro de esta instalaci贸n, puedes pasar r谩pidamente a un entorno de producci贸n a帽adiendo un archivo llamado PROCFILE. Aunque no necesita hacer nada para desarrollar, este archivo ser谩 importante en el futuro.

Es com煤n usar cualquier editor de texto que permita una interacci贸n sencilla con Git y la lectura de directorios de archivos. VS Code y Text Wrangler son opciones viables; sin embargo, la elecci贸n depender谩 de tus necesidades personales y preferencias.
驴Qu茅 archivos son cruciales para la configuraci贸n?

Uno de los primeros pasos luego de la instalaci贸n de Yii es ajustar la configuraci贸n del sistema. La carpeta de configuraci贸n incluye tres archivos clave:

    Configuraci贸n de la base de datos: Un archivo que devuelve la configuraci贸n de la base de datos. Aunque se puede trabajar con varias bases simult谩neamente, generalmente se inicia con una sola.

    La carpeta a trabajar es:
        /config
        -db.php //configurcion de la BD, se da de alta 
        -web.php  //Cada vez que incoquemos web, que muestra vistas, utilizaremos este archivo de configuraci贸n
        -console.php  //Para utilizar la consola mediante linea de comandos.



    Archivo Web: Cada vez que se invoca a Yii via web, este archivo gestiona el recorrido del controlador y la vista para generar HTML.

    Archivo Console: Este archivo es llamado cuando se interact煤a con Yii desde la l铆nea de comandos.

El archivo que se modifica de acuerdo a nuestra configuraci贸n de Bd es el archiov
    /config/db.php

Proporcionando el nombre de la base de datos, el usuario y la contrase帽a de nuestro uusuaroi en la base de datos.   Podemos incluir tambien el necodign de la BD


El corazon de todo esto es el Modelo, los datos que se van a almacenar todas las clases a crear, cada tabla tendra una correlaci贸n directa con su objeto modelo.




驴C贸mo se gestiona el modelo y los datos?

En el coraz贸n de cualquier aplicaci贸n de Yii est谩 el modelo de datos. Estos se almacenan en una carpeta dedicada exclusivamente a las clases de modelo. Cada tabla de la base de datos tiene una correlaci贸n directa con un objeto o clase modelo, lo que facilita la conexi贸n y manipulaci贸n de los datos.

La carpeta a utilizar es:

    /models
        -ContactForm.php
        -LoginForm.php
        -User.php


驴Qu茅 es un controlador y c贸mo funciona en Yii?

Yii distingue entre controladores para l铆nea de comandos y controladores de la web.

    Controladores para l铆nea de comandos: Se utilizan para operaciones b谩sicas como insertar o gestionar datos. Ejemplo de ello es el Hello Controller, que puede ejecutarse f谩cilmente desde la terminal.

Utilizando la carpeta
    /commands
        -Hellocontroller.php

Se puede utilizar como un template, que si ejecutmos
    $ php yii

    Tendremso un comando que se llama
        hello/index     Listo para ejecutarse

    $ php yii hello/index                    

    Controladores web: Cada controlador web tiene asociada una carpeta con las vistas de ese controlador. Este enfoque evita la duplicaci贸n del c贸digo al utilizar nombres espec铆ficos para cada funcionalidad.

/controllers
-SiteControllers.php

Aca se Crearan tantos controladores como se requieran, la regla basica es que haya un controlador por cada modelo.

Tendremos tantoc controladores como modelos, mas dos mas,

-SiteController - donde nace el request, ejecuta cualquier request, cada vez que hacemos un refresh a la pagina. CAda Controlador necesitara una vista.


驴C贸mo se gestionan las vistas?

Las vistas son parte esencial del patr贸n MVC y se organizan en carpetas por controlador. Los archivos PHP en estas carpetas absorben los datos del controlador y los muestran sin l贸gica de negocio. Esta separaci贸n de responsabilidades ayuda a que el c贸digo sea m谩s manejable y f谩cil de mantener.

/views

Cada controladro tendra su carpeta de vistas, entonces podremos tener 

/views/new.php

En cada uno de los controladores.Par ano confundir cada controladores.

Cada controlador web, tendra su propia carpeta, es decir

Tenemos el controlador

    SiteController.php

Site tiene una carpeta de vistas

Cada una de estas vistas, o archivos php que funciona absorviendo los datos que le manda el controlador y los imprime la inforamci贸n que tenemos.    
    
/views/site    


Hay dos archivos donde inicia la magia de yii desde la linea de comandos

yii para sistemas unix/linux/mac

el otro es
yii.bat Para sistemas windows ejecuytar desde consola, es donde se recibe la informaci贸n de la linea d ecomandos, se invoca a yii  se lanza la aplicaci贸n e imprime los outputs



驴Qu茅 otros componentes son necesarios?

Adem谩s de estos elementos, hay varios archivos y directorios cruciales que impulsan un proyecto de Yii:

    Archivos Yii y Yiibat: Servidores Unix, Linux o Mac utilizan Yii, mientras que Windows utiliza Yiibat para ejecutar comandos en consola.

    Directorio Web: Es donde reside el index.php, que lanza las solicitudes v铆a web. Este directorio es la ra铆z del servidor web y contiene elementos esenciales como im谩genes est谩ticas y configuraciones de servidor web.


La carpeta
    /web
    -/assets
    -/css
    .htaccess
    davicon.ico
    index.test.php
    index.php
    robots.txt

En esta carpeta nace el request que son las invoocaciones web criciales para trabajar con el proyecto.

Esta carpeta es la carpeta raiz de nuestro servidor web, es decir, el proyecto da aqui, aca estaran las miagenes los archivos css y js, que se utiien como assets para cualquier proyecto web.



驴C贸mo mejorar la seguridad y gesti贸n de contrase帽as?

Se recomienda crear carpetas adicionales para mejorar la seguridad y facilitar el trabajo en equipo.

    Esquema: Carpeta destinada a guardar el SQL de la base de datos.

    Ejecutar
        $ mkdir schema
        $ touch schema/schema.sql  //Placeholder sobre el que se trabajara

    Local: Carpeta para informaci贸n sensible que no se sube al repositorio, preservando as铆 datos cr铆ticos como contrase帽as y rutas secretas.

        $ mkdir local

Aca estaran los password, las rutas secretas, y despues en un bash o bat estos valores se convertiran en valores que los consume desde la configuracion de yii


Estas pr谩cticas no solo promueven buenas costumbres de desarrollo, sino que tambi茅n aseguran que el c贸digo est茅 listo para usar en diversos entornos de producci贸n.

Este enfoque estructurado hace que Yii sea una herramienta poderosa y flexible para cualquier desarrollador. Al dominar su estructura de archivos, puedes crear aplicaciones robustas y escalables. As铆 que sigue aprendiendo y explorando para sacar el m谩ximo provecho de tus proyectos en Yii.




Para la plantilla basica, tenemos
--------------------

    /
    -/asstes
    -/commands
    -/config
    -/controllers
    -/mail
    -/models
    -/runtime
    -/test
    -/vendor
    -/views
    -/web
        /assets
        /css
        /js
            codigo.js
        .bowerr
        .gitignore
        codeoption.yml
        composer.json
        composer.lock
        composer.lock
        LICENSE.md
        README.md
        requirements.php
        yii
        yii.abt


 /

Ra铆z del proyecto. Contiene el resto de los directorios y archivos clave para la configuraci贸n y ejecuci贸n del proyecto Yii 2.
 /assets

Contiene los archivos de recursos p煤blicos compilados o publicados (como CSS, JS, im谩genes) generados por Yii desde los assets registrados en la aplicaci贸n. Yii publica autom谩ticamente estos recursos para que est茅n accesibles desde el navegador.
 /commands

Aqu铆 se almacenan los comandos personalizados de consola, creados por el desarrollador. Son 煤tiles para tareas programadas, mantenimiento, migraciones, etc. Por ejemplo: php yii my-command.
 /config

Contiene todos los archivos de configuraci贸n del sistema, incluyendo la configuraci贸n del componente db (base de datos), web.php, console.php, params.php, entre otros.
 /controllers

Aqu铆 se encuentran los controladores de la aplicaci贸n. Son responsables de manejar las solicitudes del usuario, procesar datos mediante los modelos y enviar respuestas (usualmente vistas).
 /mail

Generalmente contiene plantillas de correo electr贸nico que se utilizan cuando la aplicaci贸n env铆a mensajes por email (por ejemplo, confirmaciones, restablecimiento de contrase帽a, etc.).
 /models

Contiene los modelos de la aplicaci贸n, que representan datos y l贸gica de negocio. Aqu铆 defines las clases que interact煤an con la base de datos (ActiveRecord) o que encapsulan l贸gica espec铆fica.
 /runtime

Directorio temporal utilizado por Yii para guardar archivos de cach茅, logs, archivos generados en ejecuci贸n, etc. No se debe modificar manualmente.
 /test (o /tests)

Carpeta destinada a los tests unitarios y funcionales. Si usas herramientas como PHPUnit, aqu铆 es donde se escriben los casos de prueba para asegurar que la aplicaci贸n funciona correctamente.
 /vendor

Carpeta gestionada por Composer que contiene todas las dependencias externas de la aplicaci贸n, incluyendo el n煤cleo de Yii y otras librer铆as utilizadas.
 /views

Contiene las vistas de la aplicaci贸n. Estas son plantillas que renderizan el contenido que se muestra al usuario, como HTML, con datos pasados desde los controladores.
 /web

Es el document root o ra铆z p煤blica del servidor web. Aqu铆 se colocan los archivos accesibles directamente desde el navegador. Incluye:

    index.php: punto de entrada de la aplicaci贸n.

    Archivos publicados de assets.

    Im谩genes, JS y CSS p煤blicos.

Dentro de /web (archivos y ocultos):

    .bowerrc: configuraci贸n para Bower (gestor de paquetes frontend).

    .gitignore: define qu茅 archivos/directorios ignorar en Git.

    codeception.yml: configuraci贸n de Codeception (herramienta de testing).

    composer.json: define las dependencias del proyecto.

    composer.lock: bloquea las versiones instaladas de las dependencias.

    LICENSE.md: licencia del proyecto (usualmente BSD o MIT).

    README.md: documentaci贸n inicial del proyecto.

    requirements.php: script que verifica los requisitos del servidor para ejecutar Yii.

    yii: script de consola principal de Yii.

    yii.bat: script de consola para entornos Windows.


Plantilla avanzada:
--------------------

La estructura avanzada de Yii 2, conocida como Advanced Template, dise帽ada para separar el backend y frontend de la aplicaci贸n, permitiendo mayor escalabilidad y organizaci贸n.

Para la plantilla avanzada tenemos

    /
    -/backend
    -/commond
       -/ config
       -/ fixtures
       -/mail
       -/models
       -/test
       -/widgets
            codecepio.yml
        -/console
        -/envirenment
        -frontend
        -/ vagrand
        -/vendor
            .bowerr
            .gitignore
            codeoption.yml
            composer.json
            composer.lock
            init
            init-bat
            LICENSE.md
            README.md
            requirements.php
            vagrandfile
            yii
            yii.abt
            yii.test
            yii.test.bat


 /

Ra铆z del proyecto. Contiene las carpetas clave del backend, frontend, consola, configuraci贸n compartida y archivos de arranque.
 /backend

Contiene la parte administrativa o de gesti贸n del sistema. Aqu铆 est谩n:

    controllers/, models/, views/: exclusivos para backend.

    Su propio web/ (document root del backend).

    Archivos de configuraci贸n propios (config/).

 /common

Carpeta para archivos compartidos entre el frontend, backend, consola, etc. Aqu铆 usualmente est谩n:
 /common/config

Archivos de configuraci贸n compartida: par谩metros comunes, configuraci贸n general de componentes, etc.
 /common/fixtures

Datos de prueba para pruebas autom谩ticas (tests). Se utilizan con herramientas como Codeception.
 /common/mail

Plantillas de correos reutilizables entre backend y frontend.
 /common/models

Modelos que son compartidos por todas las partes del sistema.
 /common/test

Pruebas comunes.
 /common/widgets

Widgets personalizados reutilizables en la aplicaci贸n.
 /console

Contiene la configuraci贸n y scripts para ejecutar comandos por consola. til para migraciones, tareas cron, utilidades, etc.
 /environments

Contiene configuraciones para diferentes entornos (dev, prod). Se usan con el script init para desplegar la configuraci贸n adecuada.
 /frontend

Contiene la parte p煤blica o interfaz de usuario final del sistema. Estructura similar a backend, con sus controladores, vistas, modelos, configuraci贸n, y web/ (p煤blico para el frontend).
 /vagrant

Scripts de configuraci贸n para entornos de desarrollo con Vagrant. Permite virtualizar el entorno completo del sistema para desarrollo.
 /vendor

Manejado por Composer. Contiene el c贸digo del framework Yii y otras librer铆as de terceros.

Archivos y carpetas en la ra铆z:
Archivo/Carpeta	Descripci贸n
.bowerrc	Configuraci贸n de Bower (gestor de paquetes frontend).
.gitignore	Archivos/directorios que no se suben a Git.
codeception.yml	Configuraci贸n de pruebas con Codeception.
composer.json	Lista de dependencias y configuraci贸n de Composer.
composer.lock	Bloquea las versiones de las dependencias.
init / init.bat	Script para inicializar el entorno (dev o prod).
LICENSE.md	Licencia del proyecto (usualmente BSD o MIT).
README.md	Descripci贸n general del proyecto.
requirements.php	Script que verifica requisitos del servidor para Yii.
Vagrantfile	Archivo principal de configuraci贸n para Vagrant.
yii, yii.bat	Scripts de consola para ejecutar comandos Yii (Linux/Windows).
yii.test, yii.test.bat	Scripts para ejecutar pruebas (Linux/Windows).




Los modelos permanecen entre los controladores, la vista y las bases de datos.


Se utilizan para utilizarse con los contrladores y las vistas para establecer una comunicaci贸n con la base de datos,

Con esto ya tenemos nuestro proyecto funcionando y sabemos para que sirve de manera general las carpetas de nuestro proyecto.

Por ultimo vamos a indicar cuando utilizar una plantilla basica y cuando utilizar la plantilla avanzada.

La deferencia es la estructura del proyecto, la diferencia mas obvia es que la plantilla avanzado



La diferencia radica en la estructura del proyecto. La m谩s obvia es que la plantilla avanzada ya cuenta con un backend configurado.

La siguiente tabla muestra las similitudes y diferencias entre las plantillas b谩sica y avanzada:


Caracteristicas            |       Basica      |       Avanzada
------------------------------------------------------------------

Estrcutura del proyecto             si                      si
Controladores del sitio             si                      si
Login/logout del usuario            si                      si
Formularios                         si                      si
Conexion con la BD                  si                      si
Comandos de consola                 si                      si
Paquete de activos (bundle)         si                      si
pruebas de concepto de codigo       si                      si
Boostratp                           si                      si
Apps Front-end y back-end           no                      si
Listo paa usar modelo de Usuarios   no                      si
Registro de usuarios y restauracon
de contrase帽a                       no                      si





Como puede ver, las principales diferencias son:

La plantilla avanzada admite aplicaciones front-end y back-end;
La plantilla avanzada tiene un modelo de usuario listo para usar;
La plantilla avanzada admite el registro de usuarios y la recuperaci贸n de contrase帽as.

Una de las principales diferencias (aparte de la estructura de carpetas para gestionar el front-end y el back-end) es que la plantilla avanzada cuenta con un sistema de autenticaci贸n de usuarios funcional, mientras que la plantilla b谩sica tiene a los usuarios codificados en el modelo de usuario. La plantilla avanzada cuenta con la funcionalidad de registro/contrase帽a olvidada.

No hay diferencia, ya que el c贸digo del framework principal subyacente es el mismo.